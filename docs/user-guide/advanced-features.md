# 応用機能

> Agasteerの高度な機能を説明します。

---

## 📱 2ペイン表示

Agasteerは横長画面で左右2ペイン表示に自動切替されます。

### 自動切替の仕組み

- **画面のアスペクト比が横 > 縦の場合、自動的に2ペイン表示**
- スマホを横向きにすると2ペインに切り替わります
- 縦長画面では1ペイン表示

### 左右独立操作

- 左右それぞれで異なるノート/リーフを開けます
- 左でノート一覧、右でリーフ編集、といった使い方が可能
- 左右で同じリーフを開くと、編集が即座に同期されます

### 左右でのスクロール同期

同じリーフを左右で開いた場合：

- 編集モードとプレビューモードで開くと、スクロール位置が同期します
- 一方のペインでスクロールすると、もう一方も自動的にスクロールします
- 無限ループを防ぐため、スクロール同期は一時的に停止されることがあります

### Vimモードでのペイン切り替え

Vimモードを有効にしている場合、`<Space>`キー（ノーマルモード）で左右のペインを切り替えられます。

---

## 👁️ マークダウンプレビュー

リーフのMarkdownをHTMLレンダリングして表示できます。

### プレビューの開き方

1. エディタ画面の👁️ボタン（プレビュー）をクリック
2. マークダウンがHTMLとして表示されます
3. もう一度クリックで編集モードに戻ります

### プレビューの特徴

- **marked**ライブラリでMarkdown→HTML変換
- **DOMPurify**でXSSサニタイゼーション（セキュリティ対策）
- 外部リンクは新しいタブで開きます
- コードブロックはシンタックスハイライト対応

### 編集/プレビュー間のスクロール同期

- 左ペインで編集、右ペインでプレビューを開くと、スクロール位置が同期します
- 編集中の位置がプレビューでも同じ位置に表示されます

---

## 📸 プレビュー画像のダウンロード・シェア

プレビュー表示を画像として保存・共有できます。

### 画像のダウンロード

1. プレビュー表示中に⬇️ボタン（ダウンロード）をクリック
2. プレビュー全体が1枚の画像（PNG形式）としてダウンロードされます

#### ダウンロード仕様

- **html2canvas**ライブラリで動的にキャプチャ
- 白背景 + 20pxの余白
- スクロール全体を1枚の画像にまとめます
- PNG形式で保存

### 画像のシェア

1. プレビュー表示中に📤ボタン（シェア）をクリック
2. 以下の2つの方法で共有できます：

#### 1. Clipboard APIで画像コピー

- 画像をクリップボードにコピー
- 他のアプリ（Slack、Discord等）に直接貼り付け可能

#### 2. Web Share APIで直接送信

- LINEやTwitterなどのアプリに直接送信
- モバイルデバイスで特に便利

**注意**: ブラウザによってはWeb Share APIが利用できない場合があります。

---

## ⌨️ キーボードショートカット

### Ctrl+S / Cmd+S でPush

エディタで編集中に **Ctrl+S**（Macでは **Cmd+S**）を押すと、GitHubにPushできます。

- ブラウザの「ページを保存」ダイアログはブロックされます
- 変更がある場合のみPushが実行されます（空のコミットは作成されません）
- Vimモードが有効でも動作します

---

## ⌨️ Vimモード

CodeMirrorのVimキーバインディングを使用できます。

### Vimモードの有効化

1. 設定画面を開く
2. 「Vimモード」をONに切り替え
3. 保存して閉じる

### Vimモードの操作

#### ノーマルモード

- `i` / `a` / `o` - 挿入モードへ
- `h` / `j` / `k` / `l` - カーソル移動
- `dd` - 行削除
- `yy` - 行コピー
- `p` - 貼り付け
- `u` - アンドゥ
- `Ctrl-r` - リドゥ
- **`<Space>`** - ペイン切り替え（2ペイン表示時）

#### カスタムコマンド

Agasteer専用のVimコマンドを用意しています。

- **`:w`** - GitHubにPush（保存）
- **`:q`** - 親ノートへ遷移（リーフを閉じる）
- **`:wq`** - 保存して閉じる

### 2ペインでのVimモード

左右それぞれでVimモードが独立して動作します。

- `<Space>`で左右のペインを切り替え
- 各ペインで独立してVimコマンド実行可能

---

## 🔗 シェア機能

ノートやリーフをURLやMarkdown形式で共有できます。

### URLコピー

1. パンくずリストの右側にある🔗アイコンをクリック
2. 現在の画面のURLがクリップボードにコピーされます
3. 他の人に共有したり、ブックマークとして保存できます

### Markdownコピー

1. パンくずリストの右側にある📋アイコンをクリック
2. 現在のパスがMarkdownのリンク形式でコピーされます

例：

```markdown
[Agasteer > ノート1 > リーフ1](https://agasteer.llll-ll.com/note/abc123/leaf/def456)
```

---

## 📱 PWA対応

AgasteerはPWA（Progressive Web App）として動作します。

### スマホのホーム画面に追加

#### iOS（Safari）

1. Safariでデモサイトを開く
2. 共有ボタン → 「ホーム画面に追加」
3. アイコンがホーム画面に追加されます

#### Android（Chrome）

1. Chromeでデモサイトを開く
2. メニュー → 「ホーム画面に追加」
3. アイコンがホーム画面に追加されます

### スタンドアロンモード

ホーム画面から起動すると、ブラウザのUIが表示されず、ネイティブアプリのように動作します。

---

## 🔗 タイトルリンク化

ノートやリーフのタイトルをCtrl+クリック（または中クリック）すると、新しいタブで開くことができます。

### 使い方

- **Ctrl+クリック**: 新しいタブでノート/リーフを開く
- **中クリック（マウスホイールクリック）**: 新しいタブでノート/リーフを開く

複数のノートを同時に開きたい場合に便利です。

---

## 🎯 次のステップ

応用機能を理解したら、GitHub連携を学びましょう。

→ [GitHub連携](./github-sync.md)

---

**関連ドキュメント**:

- [基本機能](./basic-features.md)
- [GitHub連携](./github-sync.md)
- [カスタマイズ](./customization.md)
