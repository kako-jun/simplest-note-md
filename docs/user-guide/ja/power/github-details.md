# GitHub連携の詳細

内部的な仕組みを説明します。

---

## 保存先のパス構造

```
.agasteer/
├── notes/              # Homeワールド
│   ├── metadata.json   # メタデータ
│   ├── ノート1/
│   │   ├── リーフ1.md
│   │   └── サブノート1/
│   │       └── リーフ3.md
│   └── ノート2/
│       └── リーフ5.md
└── archive/            # Archiveワールド
    ├── metadata.json
    └── アーカイブノート/
        └── リーフ.md
```

---

## Pushの仕組み

- **Git Tree API**で一括Push
- **SHA最適化**: 変更されていないファイルは転送しない
- **削除・リネーム対応**: 自動的に反映
- **force: true**: 個人用アプリなので常に成功優先

---

## Pullの仕組み

**優先度ベースの段階的ローディング**:

1. URLで指定されたリーフを最優先で取得
2. 同じノート配下のリーフを次に取得
3. 残りを10並列で取得

---

## API レート制限

GitHub APIには1時間5,000リクエストの制限があります。

| 操作 | 消費リクエスト数 |
| ---- | ---------------- |
| Pull | 1 + リーフ数     |
| Push | 3〜5             |

通常の使用（1日数回のPull/Push）では問題になりません。
