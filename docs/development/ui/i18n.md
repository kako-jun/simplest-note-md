## 国際化（i18n）機能

### 概要

アプリケーション全体を多言語対応にする機能。ブラウザの言語設定を自動検出し、適切な言語で表示する。ユーザーは設定画面で手動で言語を切り替えることも可能。

### 対応言語

- **日本語（ja）**: 日本語UI
- **英語（en）**: 英語UI（デフォルト）

### 技術実装

#### ライブラリ

**svelte-i18n**を使用：

- Svelte公式コミュニティで最も使われている
- TypeScript完全対応
- ローディング状態の管理が簡単
- フォールバック機能あり

#### 翻訳ファイル

`src/lib/i18n/locales/` に配置。翻訳ファイルは動的インポートで読み込み。

| ファイル                       | 説明       |
| ------------------------------ | ---------- |
| `src/lib/i18n/index.ts`        | i18n初期化 |
| `src/lib/i18n/locales/en.json` | 英語翻訳   |
| `src/lib/i18n/locales/ja.json` | 日本語翻訳 |

#### 初期化処理

1. 翻訳ファイルを`register()`で登録（動的インポート）
2. 保存された設定があればそれを使用、なければブラウザ言語を検出
3. `waitLocale()`で翻訳読み込み完了を待機

#### コンポーネントでの使用

`$_('key.path')` で翻訳文字列を取得。

### UI/UX

#### 言語自動検出

初回訪問時、ブラウザの言語設定を自動検出：

| ブラウザ言語  | 表示言語           |
| ------------- | ------------------ |
| `ja`, `ja-JP` | 日本語             |
| `en-US`       | 英語               |
| その他        | 英語（デフォルト） |

日本語（`ja`）で始まる場合のみ日本語、それ以外は全て英語。

#### 手動言語切替

設定画面に言語選択ドロップダウンを配置。言語変更は即座に反映（リロード不要）。

#### ローディング画面

翻訳ファイル読み込み中は、3つのドットのパルスアニメーションを表示。

### 仕様

- **デフォルト言語**: 英語（en）
- **サポート言語**: 日本語（ja）、英語（en）
- **保存場所**: LocalStorage `Settings.locale`
- **ローディング**: 翻訳ファイルは動的インポート（コード分割）
- **フォールバック**: 翻訳が見つからない場合は英語表示
- **リアルタイム切替**: 言語変更は即座に反映（リロード不要）
- **永続化**: 選択した言語はLocalStorageに保存され、次回起動時に復元

### 翻訳対象

以下の全UIテキストが翻訳対象：

- **共通要素**: ボタン（保存、キャンセル、削除、OK、閉じる）、デフォルト名（ノート、リーフ）
- **ヘッダー**: 設定ボタン、ペイン操作
- **パンくずリスト**: ホームへ移動、編集ボタン、ワールド切り替え
- **ホーム画面**: Push回数ラベル、統計情報
- **ノート画面**: 更新ラベル、空状態メッセージ
- **フッター**: 新規ノート、新規リーフ、削除、ダウンロード、プレビュー、保存、アーカイブ、リストア
- **設定画面**: 全セクション（GitHub連携、テーマ、フォント、背景画像、ツール名など）、aria-label
- **トースト通知**: Pull/Push開始/成功/失敗メッセージ、移動/削除/アーカイブ完了
- **モーダル**: 確認ダイアログ、エラーメッセージ、移動先選択
- **ローディング**: Pull中、Push中
- **ストレージエラー**: データベースエラーメッセージ（6種類）
- **GitHub API**: バリデーションエラー、接続テスト結果

### パフォーマンス

#### バンドルサイズ

```
dist/assets/ja-CwwTm2-M.js    2.00 kB │ gzip:  1.43 kB
dist/assets/en-DLi_lTuS.js    2.42 kB │ gzip:  1.10 kB
```

- 翻訳ファイルは動的インポート
- 使用する言語のみロード
- gzip圧縮で1.4KB程度

#### 初期化時間

- 翻訳ファイルの読み込み: ~10-50ms
- ローディング画面はほぼ一瞬（体感できないレベル）

### セキュリティ

- **XSS対策**: 翻訳文字列はエスケープ処理済み
- **JSONバリデーション**: svelte-i18nが型安全性を保証
- **静的ファイル**: 翻訳ファイルは静的JSON（実行コードなし）

---
